{{ define "main" }}
<div class="max-w-7xl mx-auto px-4 py-8">
  <div class="flex flex-col lg:flex-row gap-8">

    <!-- Sidebar / Writer Info (Right on Desktop, Top on Mobile) -->
    <aside class="lg:w-1/3 lg:order-2">
      <div class="card p-6 sticky top-24">
        {{ $writer := index $.Site.Data.writers .Data.Term }}
        <div class="w-16 h-16 rounded-full bg-muted mx-auto mb-4 flex items-center justify-center">
          {{ if $writer.avatar }}
          <img src="{{ $writer.avatar }}" alt="{{ .Title }}"
            class="w-full h-full rounded-full object-cover author-avatar">
          {{ else }}
          <span class="text-xl font-bold text-main">{{ substr .Title 0 1 }}</span>
          {{ end }}
        </div>

        <h1 class="text-2xl font-bold text-main mb-2 text-center">{{ $writer.name }}</h1>
        <p class="text-center text-muted-foreground mb-4">Published {{ len .Pages }} post{{ if ne (len .Pages) 1 }}s{{
          end }}</p>

        {{ if $writer.bio }}
        <div class="text-sm text-center text-main leading-relaxed mb-6">
          {{ $writer.bio }}
        </div>
        {{ end }}

        {{ if $writer.social_links }}
        <div class="flex flex-wrap justify-center gap-3 mb-6">
          {{ range $writer.social_links }}
          <a href="{{ .url }}" target="_blank" rel="noopener noreferrer"
            class="px-3 py-1.5 rounded-full bg-muted text-xs font-medium hover:bg-blue-100 hover:text-blue-600 dark:hover:bg-blue-900 dark:hover:text-blue-200 transition-colors">
            {{ .platform }}
          </a>
          {{ end }}
        </div>
        {{ end }}

        <div class="pt-4 border-t border-border mt-auto">
          {{ if $writer.email }}
          <div class="flex items-center justify-center text-sm text-muted-foreground mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            <a href="mailto:{{ $writer.email }}" class="hover:text-blue-600">{{ $writer.email }}</a>
          </div>
          {{ end }}

          {{ if $writer.joinedon }}
          <div class="flex items-center justify-center text-xs text-muted-foreground">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Joined {{ dateFormat "January 2006" $writer.joinedon }}
          </div>
          {{ end }}
        </div>
      </div>
    </aside>

    <!-- Main Content / Posts (Left on Desktop, Bottom on Mobile) -->
    <div class="lg:w-2/3 lg:order-1 space-y-6">
      {{ $paginator := .Paginate .Pages.ByDate.Reverse }}
      {{ range $paginator.Pages }}
      {{ $page := . }}
      <article class="card flex flex-col sm:flex-row gap-6">
        {{ with .Params.thumbnail }}
        <div class="sm:w-1/3">
          <img src="{{ . }}" alt="{{ $page.Title }}" class="card-header-img w-full h-48 object-cover rounded-lg"
            loading="lazy">
        </div>
        {{ end }}

        <div class="sm:w-{{ if .Params.thumbnail }}2/3{{ else }}full{{ end }}">
          <h2 class="card-title mb-2">
            <a href="{{ .RelPermalink }}" class="hover:text-blue-500 transition-colors">{{ .Title }}</a>
          </h2>

          <div class="card-meta mb-3">
            {{ with .Params.writers }}
            <div class="flex flex-wrap gap-1 items-center">
              {{ range . }}
              {{ $writer := index $.Site.Data.writers . }}
              <a href="/writers/{{ . | urlize }}/"
                class="flex items-center text-xs text-muted-foreground hover:text-blue-600 transition-colors">
                {{ if $writer.avatar }}
                <img src="{{ $writer.avatar }}" alt="{{ $writer.name }}"
                  class="w-4 h-4 rounded-full mr-1 object-cover author-avatar">
                {{ else }}
                <span class="w-4 h-4 rounded-full bg-muted flex items-center justify-center mr-1 text-xs">
                  {{ substr $writer.name 0 1 }}
                </span>
                {{ end }}
                <span class="truncate max-w-[80px] sm:max-w-none">{{ $writer.name }}</span>
              </a>
              {{ end }}
            </div>
            <span class="mx-2">•</span>
            {{ end }}

            <time datetime="{{ .Date.Format " 2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>

            {{ with .Params.readingTime }}
            <span class="mx-2">•</span>
            <span class="text-xs text-muted-foreground">{{ . }}</span>
            {{ end }}
          </div>

          <p class="text-main text-sm leading-relaxed mb-4">{{ .Description | truncate 150 "..." }}</p>

          <div class="card-footer flex flex-wrap items-center justify-between">
            <a href="{{ .RelPermalink }}" class="font-medium">Read more →</a>

            {{ with .Params.tags }}
            <div class="flex flex-wrap gap-1">
              {{ range first 2 . }}
              <a href="/tags/{{ . | urlize }}"
                class="bg-muted text-main text-xs px-2 py-0.5 rounded transition-colors duration-200 hover:bg-blue-600 hover:text-white dark:hover:bg-blue-700 dark:hover:text-white">
                #{{ . }}
              </a>
              {{ end }}
            </div>
            {{ end }}
          </div>
        </div>
      </article>
      {{ end }}

      <!-- Pagination -->
      {{ if gt $paginator.TotalPages 1 }}
      <div class="mt-12 flex justify-center">
        <nav class="flex items-center space-x-2">
          <a href="{{ if $paginator.HasPrev }}{{ $paginator.Prev.URL }}{{ else }}javascript:void(0){{ end }}"
            class="px-3 py-2 rounded-lg border bg-muted border-main text-main {{ if $paginator.HasPrev }}hover:text-blue-600 dark:hover:text-blue-400{{ end }} transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 {{ if not $paginator.HasPrev }}opacity-50 cursor-not-allowed{{ end }}"
            aria-label="Previous page" {{ if not $paginator.HasPrev }}aria-disabled="true" {{ end }}>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          </a>

          {{ $currentPage := $paginator.PageNumber }}
          {{ $totalPages := $paginator.TotalPages }}

          {{ if gt $totalPages 1 }}
          {{ $showPages := 3 }}
          {{ $firstPage := 1 }}
          {{ $lastPage := $totalPages }}
          {{ $startPage := sub $currentPage 1 }}
          {{ $endPage := add $currentPage 1 }}

          {{ if lt $startPage $firstPage }}
          {{ $startPage = $firstPage }}
          {{ $endPage = add $startPage $showPages }}
          {{ if gt $endPage $lastPage }}
          {{ $endPage = $lastPage }}
          {{ end }}
          {{ end }}

          {{ if gt $endPage $lastPage }}
          {{ $endPage = $lastPage }}
          {{ $startPage = sub $endPage $showPages }}
          {{ if lt $startPage $firstPage }}
          {{ $startPage = $firstPage }}
          {{ end }}
          {{ end }}

          {{ if eq $startPage 2 }}
          <a href="{{ $paginator.First.URL }}"
            class="px-4 py-2 rounded-lg border bg-muted border-main text-main hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500">1</a>
          {{ end }}

          {{ if gt $startPage 2 }}
          <a href="{{ $paginator.First.URL }}"
            class="px-4 py-2 rounded-lg border bg-muted border-main text-main hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500">1</a>
          <span class="px-2 py-2 text-main">...</span>
          {{ end }}

          {{ range $paginator.Pagers }}
          {{ $page := .PageNumber }}
          {{ if and (ge $page $startPage) (le $page $endPage) }}
          {{ if eq . $paginator }}
          <span class="px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold dark:bg-blue-500"
            aria-current="page">{{ .PageNumber }}</span>
          {{ else }}
          <a href="{{ .URL }}"
            class="px-4 py-2 rounded-lg border bg-muted border-main text-main hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500">{{
            .PageNumber }}</a>
          {{ end }}
          {{ end }}
          {{ end }}

          {{ if lt $endPage (sub $lastPage 1) }}
          <span class="px-2 py-2 text-main">...</span>
          <a href="{{ $paginator.Last.URL }}"
            class="px-4 py-2 rounded-lg border bg-muted border-main text-main hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500">{{
            $lastPage }}</a>
          {{ end }}

          {{ if and (eq $endPage (sub $lastPage 1)) (gt $totalPages 2) }}
          <a href="{{ $paginator.Last.URL }}"
            class="px-4 py-2 rounded-lg border bg-muted border-main text-main hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500">{{
            $lastPage }}</a>
          {{ end }}
          {{ end }}

          <a href="{{ if $paginator.HasNext }}{{ $paginator.Next.URL }}{{ else }}javascript:void(0){{ end }}"
            class="px-3 py-2 rounded-lg border bg-muted border-main text-main {{ if $paginator.HasNext }}hover:text-blue-600 dark:hover:text-blue-400{{ end }} transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 {{ if not $paginator.HasNext }}opacity-50 cursor-not-allowed{{ end }}"
            aria-label="Next page" {{ if not $paginator.HasNext }}aria-disabled="true" {{ end }}>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </nav>
      </div>
      {{ end }}
    </div>
  </div>
</div>
{{ end }}