{{ define "main" }}
<div class="max-w-7xl mx-auto p-6">
    <div class="flex flex-col lg:flex-row gap-8">
        <!-- Main Content -->
        <div class="lg:w-2/3">

            <!-- Section Header -->
            <div class="mb-8">
                {{ partial "breadcrumbs.html" . }}
                <h1 class="text-3xl font-bold text-main mb-4">{{ .Title }}</h1>
                {{ with .Content }}
                <div class="prose dark:prose-invert max-w-none mb-6">
                    {{ . }}
                </div>
                {{ end }}
            </div>

            <!-- Sub-Sections (e.g., Subjects under Class) -->
            {{ if .Sections }}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                {{ range .Sections }}
                <a href="{{ .RelPermalink }}"
                    class="block p-6 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-shadow">
                    <h2 class="text-xl font-bold text-main mb-2">{{ .Title }}</h2>
                    <p class="text-muted-foreground">{{ .Description | default (printf "Explore %s content" .Title) }}
                    </p>
                    <span class="inline-block mt-4 text-blue-600 dark:text-blue-400 font-medium">Browse {{ .Title }}
                        →</span>
                </a>
                {{ end }}
            </div>
            {{ end }}

            <!-- Posts List -->
            <div class="space-y-6">
                {{ $paginator := .Paginate .RegularPages }}
                {{ range $paginator.Pages }}
                {{ $page := . }}
                <article class="card flex flex-col lg:flex-row gap-6">
                    {{ with .Params.thumbnail }}
                    <div class="lg:w-1/3">
                        <img src="{{ . }}" alt="{{ $page.Title }}"
                            class="card-header-img w-full h-48 object-cover rounded-lg" loading="lazy">
                    </div>
                    {{ end }}

                    <div class="lg:w-{{ if .Params.thumbnail }}2/3{{ else }}full{{ end }}">
                        <h2 class="card-title mb-2">
                            <a href="{{ .RelPermalink }}" class="hover:text-blue-500 transition-colors">{{ .Title }}</a>
                        </h2>

                        <div class="card-meta mb-3">
                            <time datetime="{{ .Date.Format " 2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
                            {{ with .Params.readingTime }}
                            <span class="mx-2">•</span>
                            <span class="text-xs text-muted-foreground">{{ . }}</span>
                            {{ end }}
                        </div>

                        <p class="text-main leading-relaxed text-sm mb-4">{{ .Description | truncate 150 "..." }}</p>

                        <a href="{{ .RelPermalink }}"
                            class="font-medium text-blue-600 dark:text-blue-400 hover:underline">Read more →</a>
                    </div>
                </article>
                {{ end }}
            </div>

            <!-- Pagination -->
            {{ partial "pagination.html" . }}

        </div>

        <!-- Sidebar -->
        <aside class="lg:w-1/3">
            <div class="sticky top-24 space-y-8">
                <!-- Categories Widget -->
                <div class="card">
                    <h3 class="card-title mb-4">Categories</h3>
                    <div class="flex flex-col gap-2">
                        {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
                        <a href="{{ " /categories/" | relLangURL }}{{ $name | urlize }}"
                            class="flex items-center justify-between text-main hover:text-blue-600 transition-colors">
                            <span>{{ $name | humanize }}</span>
                            <span
                                class="text-sm text-muted-foreground bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full">{{
                                $taxonomy.Count }}</span>
                        </a>
                        {{ end }}
                    </div>
                </div>
            </div>
        </aside>
    </div>
</div>
{{ end }}